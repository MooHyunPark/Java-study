

익명 게시판 작성 중


추가 학습 정보 :

#### sql문 작성 시 동적으로 쿼리문 구성하기 (SqlProvider)

```
@SelectProvider(type = SQLProvider.class, method = "findAll")
@Results(id = "qnaList"
		, value = {
				@Result(column = "article_id", property = "articleId")
				, @Result(column = "title", property = "title")
				, @Result(column = "content", property = "content")
				, @Result(column = "username", property = "username")
				, @Result(column = "views", property = "views")
				, @Result(column = "is_secure", property = "secure")
				, @Result(column = "password", property = "password")
				, @Result(column = "comments", property = "comments")
		})
List<QNA> findAll(Integer limit, Integer offset, String sort, String category, String query);
	

// 모든 게시글의 수를 반환
@SelectProvider(type = SQLProvider.class, method = "count")
Integer count(String category, String query);
	
class SQLProvider {
	public static String findAll(@Param("limit") Integer limit, @Param("offset") Integer offset, @Param("sort") String sort, @Param("category") String category, @Param("query") String query) {
	    return new SQL() {{
	        SELECT("article_id, title, content, username, views, is_secure, password, comments");
	        FROM("customerqna");
	        WHERE("is_deleted = false");

	        if (category != null && query != null && !category.equals("none") && !query.equals("none")) {
	            if ("title".equals(category)) {
	                WHERE("title LIKE '%' || #{query} || '%'");
	            } else if ("content".equals(category)) {
	                WHERE("content LIKE '%' || #{query} || '%'");
	            } else if ("username".equals(category)) {
	                WHERE("username LIKE '%' || #{query} || '%'");
	            }
	        }

	        if ("views".equals(sort)) {
	            ORDER_BY("views desc, article_id desc");
	        } else if ("comments".equals(sort)) {
	            ORDER_BY("comments desc, article_id desc");
	        } else if ("old_order".equals(sort)){
	            ORDER_BY("article_id asc");
	        } else {
	        	ORDER_BY("article_id desc");
	        }
	        LIMIT("#{limit}");
	        OFFSET("#{offset}");
	    }}.toString();
	}
		
	public static String count(@Param("category") String category, @Param("query") String query) {
		return new SQL() {
			{
				SELECT("count(*)");
				FROM("customerqna");
				if (category != null && query != null && !category.equals("none") && !query.equals("none")) {
		            if ("title".equals(category)) {
		                WHERE("title LIKE '%' || #{query} || '%'");
		            } else if ("content".equals(category)) {
		                WHERE("content LIKE '%' || #{query} || '%'");
		            } else if ("username".equals(category)) {
		                WHERE("username LIKE '%' || #{query} || '%'");
		            }
		        }
			}
		}.toString();
	}
}
```





진행 과정 상황 :



